# Version logic
versions:
  - criteria:
      variant: store
    script: store-script

# Install scripts
## Store
store-script:
  info:
    name: Store CRM
    icon: FaCashRegister
    color:
      r: 0
      g: 144
      b: 227
  steps:
    - action: createModel
      required: true
      locked: false
      model: crm-products
    - registerApp

# Data to load into the system
data:
  models:
    # Base product model
    crm-products:
      name: Product
      name_plural: Products
      app: crm
      icon: FaPeopleCarry
      indexed: true
      primary: name
      fields:
        name:
          name: Name
          required: true
          type: input
        description:
          name: Description
          required: true
          type: richtext
        quantity:
          name: Quantity
          type: input
          typeArgs:
            type: number
          default: 1
        picture:
          name: Picture
          type: picture
        price:
          name: Price
          type: input
          typeArgs:
            type: number
            numberType: currency
        sold:
          name: Sold
          type: formula
          typeArgs:
            type: number
            formula: >-
              {{ count_related('crm-sales','crm-products',[{"field":"paid","operator":"equals","value":true}]) }}
        available:
          name: Available
          type: formula
          typeArgs:
            formula: >-
              {{ math("{quantity} - {sold}") }}
            type: number
      preview:
        enabled: true
        fields:
          - name
      permissions:
        read:
          - known
        create:
          - known
        modifyOwn:
          - known
        write:
          - known
        delete:
          - known
        deleteOwn:
          - known
        archive:
          - known
        archiveOwn:
          - known
      actions:
        create:
          layout: create
          type: create
      overviews:
        default:
          fields:
            - picture
            - name
            - description
            - available
          buttons:
            - create
          actions:
            - delete
      layouts:
        default:
          layout:
            - type: AnimationContainer
              xs: 12
              id: khasxdr6
              items:
                - type: GridContainer
                  xs: 12
                  id: khasxj8n
                  items:
                    - type: GridItem
                      xs: 12
                      id: khasxngg
                      md: 9
                      key: default
                      items:
                        - type: AnimationItem
                          xs: 12
                          id: khasxum6
                          items:
                            - type: Paper
                              xs: 12
                              id: khasxx1k
                              title: Product
                              withBigMargin: true
                              key: default
                              md: 9
                              items:
                                - type: Field
                                  xs: 12
                                  id: khato1rq
                                  field: name
                                  displayfields: people,price,paid
                                - type: Field
                                  xs: 12
                                  id: khato3q3
                                  field: description
                                  displayfields: people,price,paid
                                - type: Field
                                  xs: 12
                                  id: khato4v9
                                  field: quantity
                                  displayfields: people,price,paid
                                - type: Field
                                  xs: 12
                                  id: khato67v
                                  field: picture
                                  hideView: true
                                  displayfields: people,price,paid
                                - type: Field
                                  xs: 12
                                  id: khatok9q
                                  field: price
                                  hideView: true
                                  displayfields: people,price,paid
                                - type: Field
                                  xs: 12
                                  id: khatopd3
                                  field: price
                                  displayfields: people,price,paid
                    - type: GridItem
                      xs: 12
                      id: khasy8dc
                      md: 3
                      key: default
                      withBigMargin: true
                      title: Product
                      items:
                        - type: AnimationItem
                          xs: 12
                          id: khasydf2
                          items:
                            - type: RelatedList
                              xs: 12
                              id: khasymfk
                              title: Sales
                              object: crm-sales
                              field: crm-products
                              displayfields: people,price,paid
                              valueCopyFields: price=price
                              onlyVisibleWithResults: false
                              displayCard: true
                              withBigMargin: true
                              addButton: true
                              key: default
                              md: 3
          buttons:
            - delete
            - clone
            - archive
          factsBar:
            - picture
            - name
            - available
            - sold

  objects:
